<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>courses</title>
  <meta name="description"
    content="ilmify, Join Pious Brothers to explore Islamic knowledge through online quizzes, lessons, videos, and a growing Muslim learning community. 100% free and easy to access.">
  <meta name="keywords"
    content="ilmify, Islamic quiz, learn Islam, online Quran learning, Islamic education, Muslim community, Islamic website India, Pious Brothers, Islamic lessons, free Islamic resources">
  <meta name="author" content="ilmify Pious Brothers Team">
  <link rel="stylesheet" href="/pbc.css">
  <link rel="icon" href="/logoo.png" type="image/icon type">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="../firebase-config.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Anek+Latin:wght@400;700&display=swap" rel="stylesheet">
  <style>
    .title {
      font-size: 24px;
      font-family: 'anek latin' sans-serif;
    }

    .subheading {
      font-size: 16px;
      font-family: 'anek latin' sans-serif;
    }

    .video {
      margin-top: 10px;
    }
  </style>
</head>

<body class="center1 black">
  <header class="fix">
    <center>
      <a style="position: fixed; left: 20px; color: rgb(249, 247, 247);" href="/level1/course.html"><i
          class="fa-solid fa-arrow-left"></i>
      </a>
      ARABIC
    </center>
    <center>

      <a href="/level2/arabic.html" class="box">&#10094;</a>
      LEVEL 3
      <a href="/level1/arabic.html" class="box">&#10095;</a>
    </center>
    <input type="text" id="searchBox" placeholder="Search " class="form-control mt-2 "
      style="max-width: 400px; margin: auto;">
  </header>
  <br><br><br><br><br><br>
  <div>
    <center>
      <i class="fas fa-tools"></i>
      <h2>Coming Soon</h2>
      <p>We're working on adding new courses for this level.</p>
    </center>
  </div>
  <script>
    // Firebase is initialized in firebase-config.js
    const db = window.firebaseDb || firebase.database();
    const auth = window.firebaseAuth || firebase.auth();
    const container = document.getElementById("sections-container");
    const searchBox = document.getElementById("searchBox");

    let grouped = {};
    const paths = ["arabic3"];

    function renderGroups(filteredGroups) {
      container.innerHTML = '';

      const noResults = Object.keys(filteredGroups).length === 0;
      if (noResults) {
        container.innerHTML = "<p class='text-center'>No video found</p>";
        return;
      }

      for (let group in filteredGroups) {
        const slides = filteredGroups[group];

        const groupDiv = document.createElement("div");
        groupDiv.className = "section bg-light text-dark";

        let index = 0;
        const slideWrapper = document.createElement("div");

        const updateSlide = () => {
          slideWrapper.innerHTML = `
          <div class="line6">
            <div class="title"><center>${slides[index].title}</center></div>
            <div class="subheading">${slides[index].subheading || ""}</div>
            <div class="video">
              <iframe class="yout1" width="560px" height="315px" src="${slides[index].videoUrl}" 
                      frameborder="0" allowfullscreen></iframe>
            </div>
            <div>
              <button class="prev" onclick="prev${group}()">&#10094;</button>
              ${index + 1}/${slides.length}
              <button class="next" onclick="next${group}()">&#10095;</button>
              <button class="btn btn-outline-dark btn-sm rounded-circle ms-2" onclick="share${group}()" title="Share">
                <i class="fa-solid fa-share-nodes"></i>
              </button>
            </div>
          </div>
        `;
        };

        window["prev" + group] = () => {
          index = (index - 1 + slides.length) % slides.length;
          updateSlide();
        };

        window["next" + group] = () => {
          index = (index + 1) % slides.length;
          updateSlide();
        };

        window["share" + group] = () => {
          const data = slides[index];
          // Create URL with the video title as the search query
          const url = new URL(window.location.href);
          url.searchParams.set('q', data.title);
          const shareUrl = url.toString();

          const shareText = `Watch "${data.title}" on Ilmify`;

          if (navigator.share) {
            navigator.share({
              title: data.title,
              text: shareText,
              url: shareUrl
            }).catch(console.error);
          } else {
            navigator.clipboard.writeText(shareUrl).then(() => {
              alert("Link with search query copied to clipboard!");
            }).catch(err => {
              prompt("Copy this link:", shareUrl);
            });
          }
        };

        updateSlide();
        groupDiv.appendChild(slideWrapper);
        container.appendChild(groupDiv);
      }
    }

    function filterGroups(query) {
      const filteredGroups = {};

      for (let group in grouped) {
        const slides = grouped[group];
        const matched = slides.filter(slide =>
          (slide.title && slide.title.toLowerCase().includes(query)) ||
          (slide.subheading && slide.subheading.toLowerCase().includes(query)) ||
          (slide.category && slide.category.toLowerCase().includes(query))
        );

        if (matched.length > 0) {
          filteredGroups[group] = matched;
        }
      }

      renderGroups(filteredGroups);
    }

    searchBox.addEventListener("input", () => {
      const query = searchBox.value.toLowerCase().trim();
      if (!query) {
        renderGroups(grouped);
      } else {
        filterGroups(query);
      }
    });

    // REMOVE THIS LINE IF YOU WANT TO ENFORCE AUTH
    loadAllContent();



    function loadAllContent() {
      const promises = paths.map(path =>
        db.ref(path).orderByChild("order").once("value").then(snapshot => {
          const items = [];
          snapshot.forEach(child => {
            const data = child.val();
            if (data) items.push(data);
          });
          return items;
        })
      );

      Promise.all(promises).then(results => {
        grouped = {};

        results.flat().forEach(data => {
          const group = data.category || "Uncategorized";
          if (!grouped[group]) grouped[group] = [];
          grouped[group].push(data);
        });

        renderGroups(grouped);

        // Check for 'q' parameter in URL to auto-search
        const urlParams = new URLSearchParams(window.location.search);
        const queryParam = urlParams.get('q');
        if (queryParam) {
          searchBox.value = queryParam;
          filterGroups(queryParam.toLowerCase());
        }
      });
    }
  </script>
</body>

</html>